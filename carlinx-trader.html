<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="CarLinx Trader - Vehicle trader management platform">
  <meta name="theme-color" content="#0A0F1E">
  <title>CarLinx Trader</title>
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');

    :root {
      --bg-primary: #0A0F1E;
      --bg-secondary: #12182B;
      --bg-tertiary: #1A2235;
      --bg-card: #151D30;
      --bg-hover: #1E2840;
      
      --accent-primary: #00D9FF;
      --accent-secondary: #0099FF;
      --accent-glow: rgba(0, 217, 255, 0.15);
      
      --text-primary: #FFFFFF;
      --text-secondary: #A0AEC0;
      --text-muted: #718096;
      
      --border-color: rgba(255, 255, 255, 0.08);
      --border-accent: rgba(0, 217, 255, 0.3);
      
      --success: #10B981;
      --warning: #F59E0B;
      --danger: #EF4444;
      --info: #3B82F6;
      
      --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.3);
      --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.4);
      --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.5);
      --shadow-glow: 0 0 20px var(--accent-glow);
      
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      
      --transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Outfit', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-x: hidden;
      min-height: 100vh;
    }

    body::before {
      content: '';
      position: fixed;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: 
        radial-gradient(circle at 20% 30%, rgba(0, 217, 255, 0.03) 0%, transparent 50%),
        radial-gradient(circle at 80% 70%, rgba(0, 153, 255, 0.03) 0%, transparent 50%);
      z-index: -1;
      animation: gradientShift 20s ease-in-out infinite;
    }

    @keyframes gradientShift {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      50% { transform: translate(-5%, -5%) rotate(5deg); }
    }

    h1, h2, h3, h4, h5, h6 {
      font-weight: 600;
      line-height: 1.2;
      letter-spacing: -0.02em;
    }

    h1 { font-size: 2rem; }
    h2 { font-size: 1.5rem; }
    h3 { font-size: 1.25rem; }

    .mono {
      font-family: 'JetBrains Mono', monospace;
      letter-spacing: -0.01em;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1rem;
    }

    .page {
      min-height: 100vh;
      padding-bottom: 80px;
    }

    .header {
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
      padding: 1rem 0;
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(10px);
    }

    .header-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 1rem;
    }

    .logo {
      font-size: 1.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.03em;
    }

    .nav-bottom {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--bg-secondary);
      border-top: 1px solid var(--border-color);
      padding: 0.5rem;
      z-index: 100;
      backdrop-filter: blur(10px);
    }

    .nav-items {
      display: flex;
      justify-content: space-around;
      align-items: center;
      max-width: 600px;
      margin: 0 auto;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.25rem;
      padding: 0.5rem 1rem;
      color: var(--text-muted);
      text-decoration: none;
      font-size: 0.75rem;
      font-weight: 500;
      transition: var(--transition);
      border-radius: var(--radius-sm);
      cursor: pointer;
      background: transparent;
      border: none;
    }

    .nav-item:hover {
      background: var(--bg-hover);
      color: var(--text-secondary);
    }

    .nav-item.active {
      color: var(--accent-primary);
      background: var(--accent-glow);
    }

    .nav-icon {
      font-size: 1.5rem;
    }

    .card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      transition: var(--transition);
    }

    .card:hover {
      border-color: var(--border-accent);
      box-shadow: var(--shadow-glow);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
      margin: 1.5rem 0;
    }

    .stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      padding: 1.25rem;
      transition: var(--transition);
    }

    .stat-card:hover {
      border-color: var(--border-accent);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .stat-label {
      font-size: 0.875rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.5rem;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--accent-primary);
      font-family: 'JetBrains Mono', monospace;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: var(--radius-md);
      font-size: 0.875rem;
      font-weight: 600;
      font-family: 'Outfit', sans-serif;
      cursor: pointer;
      transition: var(--transition);
      text-decoration: none;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      color: var(--bg-primary);
      box-shadow: 0 4px 12px rgba(0, 217, 255, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 217, 255, 0.4);
    }

    .btn-secondary {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
    }

    .btn-secondary:hover {
      background: var(--bg-hover);
      border-color: var(--border-accent);
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-secondary);
    }

    .btn-ghost:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .btn-sm {
      padding: 0.5rem 1rem;
      font-size: 0.75rem;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.375rem 0.75rem;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .badge-success {
      background: rgba(16, 185, 129, 0.15);
      color: var(--success);
      border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .badge-warning {
      background: rgba(245, 158, 11, 0.15);
      color: var(--warning);
      border: 1px solid rgba(245, 158, 11, 0.3);
    }

    .badge-info {
      background: rgba(59, 130, 246, 0.15);
      color: var(--info);
      border: 1px solid rgba(59, 130, 246, 0.3);
    }

    .badge-secondary {
      background: rgba(160, 174, 192, 0.15);
      color: var(--text-secondary);
      border: 1px solid var(--border-color);
    }

    .vehicle-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1rem;
      margin: 1rem 0;
    }

    .vehicle-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      overflow: hidden;
      transition: var(--transition);
      cursor: pointer;
    }

    .vehicle-card:hover {
      border-color: var(--border-accent);
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }

    .vehicle-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
      background: linear-gradient(135deg, var(--bg-tertiary), var(--bg-secondary));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      color: var(--text-muted);
    }

    .vehicle-content {
      padding: 1.25rem;
    }

    .vehicle-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 1rem;
    }

    .vehicle-title {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .vehicle-year {
      color: var(--text-muted);
      font-size: 0.875rem;
    }

    .vehicle-price {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent-primary);
      font-family: 'JetBrains Mono', monospace;
    }

    .vehicle-details {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin: 1rem 0;
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .vehicle-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .lot-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1rem;
      margin: 1rem 0;
    }

    .lot-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      transition: var(--transition);
      cursor: pointer;
    }

    .lot-card:hover {
      border-color: var(--border-accent);
      transform: translateX(4px);
    }

    .lot-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 1rem;
    }

    .lot-title {
      font-size: 1.25rem;
      font-weight: 600;
    }

    .lot-location {
      color: var(--text-muted);
      font-size: 0.875rem;
      margin-top: 0.25rem;
    }

    .lot-stats {
      display: flex;
      gap: 1.5rem;
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid var(--border-color);
    }

    .lot-stat {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .lot-stat-label {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .lot-stat-value {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--accent-primary);
      font-family: 'JetBrains Mono', monospace;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: block;
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
    }

    .form-input,
    .form-select,
    .form-textarea {
      width: 100%;
      padding: 0.875rem 1rem;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-size: 0.9375rem;
      font-family: 'Outfit', sans-serif;
      transition: var(--transition);
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px var(--accent-glow);
    }

    .form-textarea {
      resize: vertical;
      min-height: 100px;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .toggle-group {
      display: flex;
      gap: 0.5rem;
      background: var(--bg-tertiary);
      padding: 0.25rem;
      border-radius: var(--radius-md);
    }

    .toggle-option {
      flex: 1;
      padding: 0.75rem 1rem;
      background: transparent;
      border: none;
      border-radius: var(--radius-sm);
      color: var(--text-secondary);
      font-size: 0.875rem;
      font-weight: 600;
      font-family: 'Outfit', sans-serif;
      cursor: pointer;
      transition: var(--transition);
    }

    .toggle-option:hover {
      color: var(--text-primary);
    }

    .toggle-option.active {
      background: var(--accent-primary);
      color: var(--bg-primary);
    }

    .image-preview {
      position: relative;
      aspect-ratio: 1;
      border-radius: var(--radius-md);
      overflow: hidden;
      background: var(--bg-tertiary);
      border: 2px solid var(--border-color);
      transition: var(--transition);
    }

    .image-preview:hover {
      border-color: var(--border-accent);
    }

    .image-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .image-preview-badge {
      position: absolute;
      top: 0.5rem;
      left: 0.5rem;
      background: var(--accent-primary);
      color: var(--bg-primary);
      padding: 0.25rem 0.5rem;
      border-radius: var(--radius-sm);
      font-size: 0.625rem;
      font-weight: 700;
      text-transform: uppercase;
    }

    .image-preview-remove {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      background: var(--danger);
      color: white;
      border: none;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      line-height: 1;
      transition: var(--transition);
      opacity: 0;
    }

    .image-preview:hover .image-preview-remove {
      opacity: 1;
    }

    .image-preview-remove:hover {
      background: #DC2626;
      transform: scale(1.1);
    }

    .image-placeholder {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 0.5rem;
      color: var(--text-muted);
      font-size: 0.75rem;
    }

    .image-placeholder-icon {
      font-size: 2rem;
      opacity: 0.5;
    }

    input[type="file"] {
      cursor: pointer;
    }

    input[type="file"]::file-selector-button {
      background: var(--bg-hover);
      border: 1px solid var(--border-color);
      color: var(--text-primary);
      padding: 0.5rem 1rem;
      border-radius: var(--radius-sm);
      cursor: pointer;
      margin-right: 1rem;
      font-family: 'Outfit', sans-serif;
      font-weight: 500;
      transition: var(--transition);
    }

    input[type="file"]::file-selector-button:hover {
      background: var(--accent-primary);
      color: var(--bg-primary);
      border-color: var(--accent-primary);
    }

    .hidden {
      display: none !important;
    }

    .mt-2 { margin-top: 1rem; }
    .mt-3 { margin-top: 1.5rem; }
    .mb-2 { margin-bottom: 1rem; }

    .empty-state {
      text-align: center;
      padding: 3rem 1rem;
      color: var(--text-muted);
    }

    .empty-state-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.3;
    }

    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 3rem;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--bg-tertiary);
      border-top-color: var(--accent-primary);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @media (min-width: 768px) {
      .vehicle-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .stats-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    @media (min-width: 1024px) {
      .vehicle-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-secondary);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--bg-tertiary);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--bg-hover);
    }

    ::selection {
      background: var(--accent-primary);
      color: var(--bg-primary);
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <div class="logo">CarLinx Trader</div>
      <div>
        <button class="btn btn-ghost btn-sm" style="padding: 0.5rem;" title="Notifications">üîî</button>
      </div>
    </div>
  </header>

  <!-- Main Content Area -->
  <main id="app-content" class="page">
    <!-- Content will be dynamically loaded here -->
  </main>

  <!-- Bottom Navigation -->
  <nav class="nav-bottom">
    <div class="nav-items">
      <button class="nav-item active" data-view="dashboard">
        <span class="nav-icon">üìä</span>
        <span>Dashboard</span>
      </button>
      <button class="nav-item" data-view="lots">
        <span class="nav-icon">üè¢</span>
        <span>Lots</span>
      </button>
      <button class="nav-item" data-view="vehicles">
        <span class="nav-icon">üöó</span>
        <span>Vehicles</span>
      </button>
      <button class="nav-item" data-view="consumer">
        <span class="nav-icon">üëÅÔ∏è</span>
        <span>Consumer</span>
      </button>
    </div>
  </nav>

  <script>
    // ===== DATA =====
    const appData = {
      trader: {
        id: "trader-001",
        name: "Brighton Auto Traders",
        location: { town: "Brighton", postcode: "BN1" }
      },
      lots: [
        {
          id: "lot-001",
          name: "Brighton Used Cars",
          location: { town: "Brighton", postcode: "BN1" },
          lotType: "used",
          status: "live",
          vehicleIds: ["veh-001", "veh-002", "veh-004"]
        },
        {
          id: "lot-002",
          name: "Prestige Selection",
          location: { town: "Brighton", postcode: "BN2" },
          lotType: "mixed",
          status: "live",
          vehicleIds: ["veh-003", "veh-005"]
        },
        {
          id: "lot-003",
          name: "Commercial Fleet",
          location: { town: "Hove", postcode: "BN3" },
          lotType: "used",
          status: "live",
          vehicleIds: ["veh-006"]
        }
      ],
      vehicles: [
        {
          id: "veh-001",
          lotId: "lot-001",
          make: "Ford",
          model: "Focus",
          year: 2018,
          bodyType: "Hatchback",
          fuelType: "Petrol",
          transmission: "Manual",
          price: 8495,
          listingType: "open",
          status: "live",
          description: "Well maintained Ford Focus with full service history. Ideal family hatchback with low mileage.",
          offers: { enabled: true, count: 3, highest: 8100 }
        },
        {
          id: "veh-002",
          lotId: "lot-001",
          make: "Volkswagen",
          model: "Golf",
          year: 2017,
          bodyType: "Hatchback",
          fuelType: "Diesel",
          transmission: "Automatic",
          price: 9295,
          listingType: "public-silent",
          status: "live",
          description: "Smooth automatic Golf, ideal motorway car. Recent service and new tyres.",
          offers: { enabled: true, count: 1, highest: 9000 }
        },
        {
          id: "veh-003",
          lotId: "lot-002",
          make: "BMW",
          model: "320d M Sport",
          year: 2019,
          bodyType: "Saloon",
          fuelType: "Diesel",
          transmission: "Automatic",
          price: 17995,
          listingType: "trade-silent",
          status: "draft",
          description: "Premium saloon in excellent condition. Full BMW service history and loaded with extras.",
          offers: { enabled: false, count: 0, highest: null }
        },
        {
          id: "veh-004",
          lotId: "lot-001",
          make: "Toyota",
          model: "Yaris",
          year: 2019,
          bodyType: "Hatchback",
          fuelType: "Hybrid",
          transmission: "Automatic",
          price: 11495,
          listingType: "open",
          status: "live",
          description: "Economical hybrid with low running costs and city-friendly size.",
          offers: { enabled: true, count: 2, highest: 11200 }
        },
        {
          id: "veh-005",
          lotId: "lot-002",
          make: "Audi",
          model: "A4",
          year: 2020,
          bodyType: "Saloon",
          fuelType: "Diesel",
          transmission: "Automatic",
          price: 19995,
          listingType: "open",
          status: "live",
          description: "Executive saloon with full leather interior and tech package.",
          offers: { enabled: true, count: 5, highest: 19500 }
        },
        {
          id: "veh-006",
          lotId: "lot-003",
          make: "Ford",
          model: "Transit",
          year: 2018,
          bodyType: "Van",
          fuelType: "Diesel",
          transmission: "Manual",
          price: 12995,
          listingType: "trade-silent",
          status: "live",
          description: "Reliable commercial van with full service history.",
          offers: { enabled: true, count: 0, highest: null }
        }
      ]
    };

    // ===== APP LOGIC =====
    class CarLinxApp {
      constructor() {
        this.currentView = 'dashboard';
        this.currentVehicle = null;
        this.editingVehicle = null;
        this.init();
      }

      init() {
        this.setupNavigation();
        this.renderView('dashboard');
      }

      setupNavigation() {
        document.querySelectorAll('.nav-item').forEach(item => {
          item.addEventListener('click', (e) => {
            const view = e.currentTarget.dataset.view;
            this.navigateTo(view);
          });
        });
      }

      navigateTo(view, data = {}) {
        // Update active nav
        document.querySelectorAll('.nav-item').forEach(item => {
          item.classList.remove('active');
          if (item.dataset.view === view) {
            item.classList.add('active');
          }
        });

        this.currentView = view;
        if (data.vehicleId) this.currentVehicle = data.vehicleId;
        if (data.editVehicleId !== undefined) this.editingVehicle = data.editVehicleId;

        this.renderView(view, data);
        window.scrollTo(0, 0);
      }

      renderView(view, data = {}) {
        const content = document.getElementById('app-content');
        
        switch(view) {
          case 'dashboard':
            content.innerHTML = this.renderDashboard();
            break;
          case 'lots':
            content.innerHTML = this.renderLots();
            this.attachLotHandlers();
            break;
          case 'vehicles':
            content.innerHTML = this.renderVehicles(data.lotId);
            this.attachVehicleHandlers();
            break;
          case 'vehicle-detail':
            content.innerHTML = this.renderVehicleDetail(this.currentVehicle);
            this.attachDetailHandlers();
            break;
          case 'vehicle-edit':
            content.innerHTML = this.renderVehicleEdit(this.editingVehicle);
            this.attachEditHandlers();
            break;
          case 'consumer':
            content.innerHTML = this.renderConsumerView();
            break;
        }
      }

      renderDashboard() {
        const stats = this.getDashboardStats();
        const listingTypes = this.getListingTypeCounts();

        return `
          <div class="container">
            <section style="margin: 2rem 0;">
              <h1>${appData.trader.name}</h1>
              <p style="color: var(--text-muted);">${appData.trader.location.town}, ${appData.trader.location.postcode}</p>
            </section>

            <section>
              <h2 style="margin-bottom: 1rem;">Overview</h2>
              <div class="stats-grid">
                <div class="stat-card">
                  <div class="stat-label">Total Vehicles</div>
                  <div class="stat-value">${stats.totalVehicles}</div>
                </div>
                <div class="stat-card">
                  <div class="stat-label">Live</div>
                  <div class="stat-value">${stats.liveListings}</div>
                </div>
                <div class="stat-card">
                  <div class="stat-label">Draft</div>
                  <div class="stat-value">${stats.draftListings}</div>
                </div>
                <div class="stat-card">
                  <div class="stat-label">Active Lots</div>
                  <div class="stat-value">${stats.activeLots}</div>
                </div>
              </div>
            </section>

            <section style="margin-top: 2rem;">
              <h2 style="margin-bottom: 1rem;">Marketplace Modes</h2>
              <div class="card">
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem;">
                  <div>
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                      <span class="badge badge-info">Trade Silent</span>
                      <span class="mono" style="font-size: 1.25rem; color: var(--accent-primary);">${listingTypes['trade-silent']}</span>
                    </div>
                    <p style="font-size: 0.875rem; color: var(--text-muted);">Visible to traders only</p>
                  </div>
                  <div>
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                      <span class="badge badge-warning">Public Silent</span>
                      <span class="mono" style="font-size: 1.25rem; color: var(--accent-primary);">${listingTypes['public-silent']}</span>
                    </div>
                    <p style="font-size: 0.875rem; color: var(--text-muted);">Public, offers hidden</p>
                  </div>
                  <div>
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                      <span class="badge badge-success">Open Listing</span>
                      <span class="mono" style="font-size: 1.25rem; color: var(--accent-primary);">${listingTypes['open']}</span>
                    </div>
                    <p style="font-size: 0.875rem; color: var(--text-muted);">Standard public listing</p>
                  </div>
                  <div>
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                      <span class="badge badge-secondary">Fixed Price</span>
                      <span class="mono" style="font-size: 1.25rem; color: var(--accent-primary);">0</span>
                    </div>
                    <p style="font-size: 0.875rem; color: var(--text-muted);">No offers accepted</p>
                  </div>
                </div>
              </div>
            </section>

            <section style="margin-top: 2rem;">
              <h2 style="margin-bottom: 1rem;">Quick Actions</h2>
              <div style="display: grid; grid-template-columns: 1fr; gap: 1rem;">
                <button class="btn btn-primary" onclick="app.navigateTo('vehicle-edit', {editVehicleId: null})">
                  ‚ûï Add New Vehicle
                </button>
                <button class="btn btn-secondary" onclick="app.navigateTo('vehicles')">
                  üìã View All Vehicles
                </button>
                <button class="btn btn-secondary" onclick="app.navigateTo('consumer')">
                  üëÅÔ∏è Consumer View
                </button>
              </div>
            </section>
          </div>
        `;
      }

      renderLots() {
        const lots = appData.lots;

        if (lots.length === 0) {
          return this.renderEmptyState('No lots found', 'Create your first lot to get started');
        }

        const lotsHtml = lots.map(lot => {
          const vehicles = appData.vehicles.filter(v => v.lotId === lot.id);
          const liveVehicles = vehicles.filter(v => v.status === 'live').length;
          
          return `
            <div class="lot-card" data-lot-id="${lot.id}">
              <div class="lot-header">
                <div>
                  <h3 class="lot-title">${lot.name}</h3>
                  <div class="lot-location">${lot.location.town}, ${lot.location.postcode}</div>
                </div>
                <span class="badge ${lot.status === 'live' ? 'badge-success' : 'badge-secondary'}">
                  ${lot.status}
                </span>
              </div>
              <div class="lot-stats">
                <div class="lot-stat">
                  <div class="lot-stat-label">Type</div>
                  <div class="lot-stat-value" style="font-size: 1rem; color: var(--text-secondary);">
                    ${lot.lotType}
                  </div>
                </div>
                <div class="lot-stat">
                  <div class="lot-stat-label">Vehicles</div>
                  <div class="lot-stat-value">${vehicles.length}</div>
                </div>
                <div class="lot-stat">
                  <div class="lot-stat-label">Live</div>
                  <div class="lot-stat-value">${liveVehicles}</div>
                </div>
              </div>
            </div>
          `;
        }).join('');

        return `
          <div class="container">
            <section style="margin: 2rem 0;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h1>Car Lots</h1>
                <button class="btn btn-primary btn-sm" onclick="alert('Add lot feature coming soon')">
                  ‚ûï Add Lot
                </button>
              </div>
              <p style="color: var(--text-muted);">Manage your vehicle lot locations and inventory</p>
            </section>

            <section>
              <div class="lot-grid">
                ${lotsHtml}
              </div>
            </section>
          </div>
        `;
      }

      renderVehicles(filterLotId = null) {
        let vehicles = appData.vehicles;
        let pageTitle = 'All Vehicles';

        if (filterLotId) {
          vehicles = vehicles.filter(v => v.lotId === filterLotId);
          const lot = appData.lots.find(l => l.id === filterLotId);
          pageTitle = lot ? `${lot.name} - Vehicles` : 'Lot Vehicles';
        }

        const vehiclesHtml = this.renderVehicleCards(vehicles, false);

        return `
          <div class="container">
            <section style="margin: 2rem 0;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h1>${pageTitle}</h1>
                <button class="btn btn-primary btn-sm" onclick="app.navigateTo('vehicle-edit', {editVehicleId: null})">
                  ‚ûï Add Vehicle
                </button>
              </div>
              <p style="color: var(--text-muted);">Manage your vehicle inventory and listings</p>
            </section>

            <section>
              <div class="vehicle-grid">
                ${vehiclesHtml}
              </div>
            </section>
          </div>
        `;
      }

      renderVehicleDetail(vehicleId) {
        const vehicle = appData.vehicles.find(v => v.id === vehicleId);
        
        if (!vehicle) {
          return this.renderEmptyState('Vehicle not found', 'This vehicle may have been removed');
        }

        return `
          <div class="container">
            <section style="margin: 1.5rem 0;">
              <button class="btn btn-ghost btn-sm" onclick="app.navigateTo('vehicles')">
                ‚Üê Back
              </button>
            </section>

            <section style="margin-bottom: 2rem;">
              <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                <div>
                  <h1 style="margin-bottom: 0.5rem;">${vehicle.make} ${vehicle.model}</h1>
                  <p style="color: var(--text-muted); font-size: 1.125rem;">${vehicle.year}</p>
                </div>
                <div>
                  <div class="mono" style="font-size: 2rem; font-weight: 700; color: var(--accent-primary);">${this.formatPrice(vehicle.price)}</div>
                </div>
              </div>
              
              <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
                <span class="badge ${this.getStatusBadgeClass(vehicle.status)}">${vehicle.status}</span>
                <span class="badge badge-info">${this.getListingTypeLabel(vehicle.listingType)}</span>
              </div>
            </section>

            <section style="margin-bottom: 2rem;">
              ${vehicle.images && vehicle.images.primary ? `
                <img src="${vehicle.images.primary}" 
                     alt="${vehicle.make} ${vehicle.model}" 
                     style="width: 100%; height: 300px; object-fit: cover; border-radius: var(--radius-lg); margin-bottom: 1rem;">
                
                ${vehicle.images.gallery && vehicle.images.gallery.length > 1 ? `
                  <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 0.5rem;">
                    ${vehicle.images.gallery.slice(1).map((img, idx) => `
                      <img src="${img}" 
                           alt="${vehicle.make} ${vehicle.model} - Image ${idx + 2}"
                           style="width: 100%; height: 100px; object-fit: cover; border-radius: var(--radius-md); cursor: pointer; border: 2px solid var(--border-color); transition: var(--transition);"
                           onmouseover="this.style.borderColor='var(--border-accent)'"
                           onmouseout="this.style.borderColor='var(--border-color)'"
                           onclick="document.querySelector('section img').src = this.src">
                    `).join('')}
                  </div>
                ` : ''}
              ` : `
                <div style="width: 100%; height: 250px; background: linear-gradient(135deg, var(--bg-tertiary), var(--bg-secondary)); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center; color: var(--text-muted); font-size: 3rem;">
                  üöó
                </div>
              `}
            </section>

            <section style="margin-bottom: 2rem;">
              <h2 style="margin-bottom: 1rem;">Specifications</h2>
              <div class="card">
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem;">
                  <div>
                    <div style="font-size: 0.875rem; color: var(--text-muted); margin-bottom: 0.25rem;">Body Type</div>
                    <div style="font-weight: 600;">${vehicle.bodyType}</div>
                  </div>
                  <div>
                    <div style="font-size: 0.875rem; color: var(--text-muted); margin-bottom: 0.25rem;">Fuel Type</div>
                    <div style="font-weight: 600;">${vehicle.fuelType}</div>
                  </div>
                  <div>
                    <div style="font-size: 0.875rem; color: var(--text-muted); margin-bottom: 0.25rem;">Transmission</div>
                    <div style="font-weight: 600;">${vehicle.transmission}</div>
                  </div>
                </div>
              </div>
            </section>

            <section style="margin-bottom: 2rem;">
              <h2 style="margin-bottom: 1rem;">Description</h2>
              <div class="card">
                <p style="color: var(--text-secondary); line-height: 1.6;">
                  ${vehicle.description}
                </p>
              </div>
            </section>

            <section style="margin-bottom: 2rem;">
              <h2 style="margin-bottom: 1rem;">Offers</h2>
              <div class="card">
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem;">
                  <div>
                    <div style="font-size: 0.875rem; color: var(--text-muted); margin-bottom: 0.5rem;">Total Offers</div>
                    <div class="mono" style="font-size: 1.5rem; font-weight: 700; color: var(--accent-primary);">${vehicle.offers.count}</div>
                  </div>
                  <div>
                    <div style="font-size: 0.875rem; color: var(--text-muted); margin-bottom: 0.5rem;">Highest Offer</div>
                    <div class="mono" style="font-size: 1.5rem; font-weight: 700; color: var(--accent-primary);">
                      ${vehicle.offers.highest ? this.formatPrice(vehicle.offers.highest) : 'No offers'}
                    </div>
                  </div>
                </div>
                <button class="btn btn-secondary mt-3" style="width: 100%;" onclick="alert('View offers feature coming soon')">
                  View All Offers
                </button>
              </div>
            </section>

            <section style="margin-bottom: 2rem;">
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <button class="btn btn-primary" onclick="app.navigateTo('vehicle-edit', {editVehicleId: '${vehicle.id}'})">
                  ‚úèÔ∏è Edit Vehicle
                </button>
                <button class="btn btn-secondary" onclick="alert('More actions coming soon')">
                  ‚ãØ More Actions
                </button>
              </div>
            </section>
          </div>
        `;
      }

      renderVehicleEdit(vehicleId) {
        const vehicle = vehicleId ? appData.vehicles.find(v => v.id === vehicleId) : null;
        const isNew = !vehicle;
        const pageTitle = isNew ? 'Add Vehicle' : 'Edit Vehicle';

        const formData = vehicle || {
          make: '',
          model: '',
          year: '',
          price: '',
          bodyType: '',
          fuelType: '',
          transmission: '',
          description: '',
          lotId: '',
          listingType: 'open',
          status: 'draft'
        };

        return `
          <div class="container">
            <section style="margin: 1.5rem 0;">
              <button class="btn btn-ghost btn-sm" onclick="app.navigateTo(app.currentVehicle ? 'vehicle-detail' : 'vehicles')">
                ‚Üê Back
              </button>
            </section>

            <section style="margin-bottom: 2rem;">
              <h1>${pageTitle}</h1>
              <p style="color: var(--text-muted);">Update vehicle information and listing settings</p>
            </section>

            <form id="vehicle-form" onsubmit="app.saveVehicle(event, '${vehicleId || ''}')">
              <section style="margin-bottom: 2rem;">
                <h2 style="margin-bottom: 1rem;">Vehicle Information</h2>
                
                <div class="form-group">
                  <label class="form-label">Make</label>
                  <input type="text" name="make" class="form-input" value="${formData.make}" required placeholder="e.g. Ford">
                </div>

                <div class="form-group">
                  <label class="form-label">Model</label>
                  <input type="text" name="model" class="form-input" value="${formData.model}" required placeholder="e.g. Focus">
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label">Year</label>
                    <input type="number" name="year" class="form-input" value="${formData.year}" required placeholder="2018" min="1990" max="2026">
                  </div>

                  <div class="form-group">
                    <label class="form-label">Price (¬£)</label>
                    <input type="number" name="price" class="form-input" value="${formData.price}" required placeholder="8495" min="0" step="1">
                  </div>
                </div>

                <div class="form-group">
                  <label class="form-label">Body Type</label>
                  <select name="bodyType" class="form-select" required>
                    <option value="">Select body type</option>
                    ${['Hatchback', 'Saloon', 'Estate', 'SUV', 'Coupe', 'Convertible', 'Van', 'MPV'].map(type => 
                      `<option value="${type}" ${formData.bodyType === type ? 'selected' : ''}>${type}</option>`
                    ).join('')}
                  </select>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label">Fuel Type</label>
                    <select name="fuelType" class="form-select" required>
                      <option value="">Select fuel</option>
                      ${['Petrol', 'Diesel', 'Hybrid', 'Electric', 'Plug-in Hybrid'].map(type => 
                        `<option value="${type}" ${formData.fuelType === type ? 'selected' : ''}>${type}</option>`
                      ).join('')}
                    </select>
                  </div>

                  <div class="form-group">
                    <label class="form-label">Transmission</label>
                    <select name="transmission" class="form-select" required>
                      <option value="">Select transmission</option>
                      ${['Manual', 'Automatic', 'Semi-Automatic'].map(type => 
                        `<option value="${type}" ${formData.transmission === type ? 'selected' : ''}>${type}</option>`
                      ).join('')}
                    </select>
                  </div>
                </div>

                <div class="form-group">
                  <label class="form-label">Description</label>
                  <textarea name="description" class="form-textarea" required placeholder="Enter vehicle description...">${formData.description}</textarea>
                </div>
              </section>

              <section style="margin-bottom: 2rem;">
                <h2 style="margin-bottom: 1rem;">Vehicle Images</h2>
                
                <div class="form-group">
                  <label class="form-label">Upload Images</label>
                  <input type="file" 
                         id="vehicle-images" 
                         accept="image/*" 
                         multiple 
                         class="form-input"
                         onchange="app.handleImageUpload(event)"
                         style="padding: 0.5rem;">
                  <p style="font-size: 0.875rem; color: var(--text-muted); margin-top: 0.5rem;">
                    Upload up to 5 images. First image will be the primary photo.
                  </p>
                </div>

                <div id="image-preview-container" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 1rem; margin-top: 1rem;">
                  ${vehicle && vehicle.images ? this.renderImagePreviews(vehicle.images) : ''}
                </div>
              </section>

              <section style="margin-bottom: 2rem;">
                <h2 style="margin-bottom: 1rem;">Lot Assignment</h2>
                
                <div class="form-group">
                  <label class="form-label">Car Lot</label>
                  <select name="lotId" class="form-select" required>
                    <option value="">Select lot</option>
                    ${appData.lots.map(lot => 
                      `<option value="${lot.id}" ${formData.lotId === lot.id ? 'selected' : ''}>${lot.name}</option>`
                    ).join('')}
                  </select>
                </div>
              </section>

              <section style="margin-bottom: 2rem;">
                <h2 style="margin-bottom: 1rem;">Listing Settings</h2>
                
                <div class="form-group">
                  <label class="form-label">Listing Type</label>
                  <div class="toggle-group">
                    <button type="button" class="toggle-option ${formData.listingType === 'open' ? 'active' : ''}" 
                            onclick="app.selectListingType(event, 'open')">
                      Open
                    </button>
                    <button type="button" class="toggle-option ${formData.listingType === 'trade-silent' ? 'active' : ''}" 
                            onclick="app.selectListingType(event, 'trade-silent')">
                      Trade Silent
                    </button>
                    <button type="button" class="toggle-option ${formData.listingType === 'public-silent' ? 'active' : ''}" 
                            onclick="app.selectListingType(event, 'public-silent')">
                      Public Silent
                    </button>
                  </div>
                  <input type="hidden" name="listingType" value="${formData.listingType}">
                  <p id="listing-type-desc" style="font-size: 0.875rem; color: var(--text-muted); margin-top: 0.5rem;">
                    ${this.getListingTypeDescription(formData.listingType)}
                  </p>
                </div>

                <div class="form-group">
                  <label class="form-label">Status</label>
                  <div class="toggle-group">
                    <button type="button" class="toggle-option ${formData.status === 'draft' ? 'active' : ''}" 
                            onclick="app.selectStatus(event, 'draft')">
                      Draft
                    </button>
                    <button type="button" class="toggle-option ${formData.status === 'live' ? 'active' : ''}" 
                            onclick="app.selectStatus(event, 'live')">
                      Live
                    </button>
                    <button type="button" class="toggle-option ${formData.status === 'sold' ? 'active' : ''}" 
                            onclick="app.selectStatus(event, 'sold')">
                      Sold
                    </button>
                  </div>
                  <input type="hidden" name="status" value="${formData.status}">
                </div>
              </section>

              <section style="margin-bottom: 2rem;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                  <button type="button" class="btn btn-secondary" onclick="app.navigateTo(app.currentVehicle ? 'vehicle-detail' : 'vehicles')">
                    Cancel
                  </button>
                  <button type="submit" class="btn btn-primary">
                    Save Vehicle
                  </button>
                </div>
              </section>
            </form>
          </div>
        `;
      }

      renderConsumerView() {
        const liveVehicles = appData.vehicles.filter(v => v.status === 'live');
        const vehiclesHtml = this.renderVehicleCards(liveVehicles, true);

        return `
          <div class="container">
            <section style="margin: 2rem 0;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <div>
                  <h1>Consumer View</h1>
                  <p style="color: var(--text-muted); margin-top: 0.5rem;">How your live listings appear to customers</p>
                </div>
              </div>
            </section>

            <section style="margin-bottom: 2rem;">
              <div class="card" style="background: rgba(59, 130, 246, 0.1); border-color: rgba(59, 130, 246, 0.3);">
                <div style="display: flex; gap: 1rem; align-items: start;">
                  <span style="font-size: 1.5rem;">‚ÑπÔ∏è</span>
                  <div>
                    <h3 style="margin-bottom: 0.5rem; color: var(--info);">Preview Mode</h3>
                    <p style="font-size: 0.875rem; color: var(--text-secondary);">
                      This is how your live vehicles appear to public consumers. Only vehicles with "Live" status are shown here.
                    </p>
                  </div>
                </div>
              </div>
            </section>

            <section>
              <h2 style="margin-bottom: 1rem;">Available Vehicles</h2>
              <div class="vehicle-grid">
                ${vehiclesHtml}
              </div>
            </section>

            <section style="margin-top: 3rem; text-align: center;">
              <button class="btn btn-secondary" onclick="app.navigateTo('dashboard')">
                ‚Üê Back to Trader Dashboard
              </button>
            </section>
          </div>
        `;
      }

      renderVehicleCards(vehicles, isConsumerView = false) {
        if (vehicles.length === 0) {
          return this.renderEmptyState('No vehicles found', 'Add your first vehicle to get started');
        }

        return vehicles.map(vehicle => `
          <div class="vehicle-card" data-vehicle-id="${vehicle.id}">
            ${vehicle.images && vehicle.images.primary ? `
              <img src="${vehicle.images.primary}" 
                   alt="${vehicle.make} ${vehicle.model}" 
                   class="vehicle-image"
                   style="object-fit: cover;">
            ` : `
              <div class="vehicle-image">üöó</div>
            `}
            <div class="vehicle-content">
              <div class="vehicle-header">
                <div>
                  <h3 class="vehicle-title">${vehicle.make} ${vehicle.model}</h3>
                  <div class="vehicle-year">${vehicle.year}</div>
                </div>
                <div class="vehicle-price">${this.formatPrice(vehicle.price)}</div>
              </div>
              <div class="vehicle-details">
                <span>üöó ${vehicle.bodyType}</span>
                <span>‚õΩ ${vehicle.fuelType}</span>
                <span>‚öôÔ∏è ${vehicle.transmission}</span>
              </div>
              ${!isConsumerView ? `
                <div class="vehicle-badges">
                  <span class="badge ${this.getStatusBadgeClass(vehicle.status)}">
                    ${vehicle.status}
                  </span>
                  <span class="badge badge-info">
                    ${this.getListingTypeLabel(vehicle.listingType)}
                  </span>
                  ${vehicle.offers && vehicle.offers.count > 0 ? `
                    <span class="badge badge-secondary">
                      ${vehicle.offers.count} offer${vehicle.offers.count !== 1 ? 's' : ''}
                    </span>
                  ` : ''}
                </div>
              ` : ''}
            </div>
          </div>
        `).join('');
      }

      renderEmptyState(title, message) {
        return `
          <div class="container">
            <div class="empty-state">
              <div class="empty-state-icon">üì¶</div>
              <h3 style="font-size: 1.25rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 0.5rem;">
                ${title}
              </h3>
              <p style="font-size: 0.875rem;">${message}</p>
            </div>
          </div>
        `;
      }

      attachLotHandlers() {
        document.querySelectorAll('.lot-card').forEach(card => {
          card.addEventListener('click', () => {
            const lotId = card.dataset.lotId;
            this.navigateTo('vehicles', { lotId });
          });
        });
      }

      attachVehicleHandlers() {
        document.querySelectorAll('.vehicle-card').forEach(card => {
          card.addEventListener('click', () => {
            const vehicleId = card.dataset.vehicleId;
            this.navigateTo('vehicle-detail', { vehicleId });
          });
        });
      }

      attachDetailHandlers() {
        // Handlers attached via onclick in HTML
      }

      attachEditHandlers() {
        // Form and toggle handlers attached via onclick in HTML
      }

      selectListingType(event, type) {
        event.preventDefault();
        
        const form = document.getElementById('vehicle-form');
        form.querySelectorAll('.toggle-option').forEach((btn, idx) => {
          if (idx < 3) { // First toggle group
            btn.classList.remove('active');
          }
        });
        event.currentTarget.classList.add('active');
        
        form.querySelector('[name="listingType"]').value = type;
        document.getElementById('listing-type-desc').textContent = this.getListingTypeDescription(type);
      }

      selectStatus(event, status) {
        event.preventDefault();
        
        const form = document.getElementById('vehicle-form');
        form.querySelectorAll('.toggle-option').forEach((btn, idx) => {
          if (idx >= 3) { // Second toggle group
            btn.classList.remove('active');
          }
        });
        event.currentTarget.classList.add('active');
        
        form.querySelector('[name="status"]').value = status;
      }

      handleImageUpload(event) {
        const files = Array.from(event.target.files);
        
        if (files.length === 0) return;
        
        // Limit to 5 images
        if (files.length > 5) {
          alert('Maximum 5 images allowed. Only first 5 will be used.');
          files.splice(5);
        }

        // Store uploaded images temporarily
        if (!this.uploadedImages) {
          this.uploadedImages = [];
        }

        // Clear previous uploads
        this.uploadedImages = [];

        // Convert files to base64 data URLs
        const promises = files.map(file => {
          return new Promise((resolve, reject) => {
            // Validate file type
            if (!file.type.startsWith('image/')) {
              reject(new Error('Only image files are allowed'));
              return;
            }

            // Validate file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
              reject(new Error('Image size must be less than 5MB'));
              return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
              resolve({
                name: file.name,
                dataUrl: e.target.result
              });
            };
            reader.onerror = reject;
            reader.readAsDataURL(file);
          });
        });

        Promise.all(promises)
          .then(images => {
            this.uploadedImages = images;
            this.renderImagePreviews(null, images);
          })
          .catch(error => {
            alert('Error uploading images: ' + error.message);
          });
      }

      renderImagePreviews(existingImages, uploadedImages) {
        const container = document.getElementById('image-preview-container');
        if (!container) return '';

        let imagesToShow = [];
        
        if (uploadedImages && uploadedImages.length > 0) {
          imagesToShow = uploadedImages.map((img, idx) => ({
            src: img.dataUrl,
            isPrimary: idx === 0,
            isNew: true
          }));
        } else if (existingImages && existingImages.gallery && existingImages.gallery.length > 0) {
          imagesToShow = existingImages.gallery.map((src, idx) => ({
            src: src,
            isPrimary: idx === 0,
            isNew: false
          }));
        }

        if (imagesToShow.length === 0) {
          container.innerHTML = `
            <div class="image-preview">
              <div class="image-placeholder">
                <span class="image-placeholder-icon">üì∑</span>
                <span>No images</span>
              </div>
            </div>
          `;
          return;
        }

        container.innerHTML = imagesToShow.map((img, idx) => `
          <div class="image-preview">
            <img src="${img.src}" alt="Vehicle image ${idx + 1}">
            ${img.isPrimary ? '<span class="image-preview-badge">Primary</span>' : ''}
            <button type="button" 
                    class="image-preview-remove" 
                    onclick="app.removeImage(${idx})"
                    title="Remove image">
              √ó
            </button>
          </div>
        `).join('');
      }

      removeImage(index) {
        if (this.uploadedImages && this.uploadedImages.length > 0) {
          this.uploadedImages.splice(index, 1);
          this.renderImagePreviews(null, this.uploadedImages);
          
          // Update file input if all images removed
          if (this.uploadedImages.length === 0) {
            const fileInput = document.getElementById('vehicle-images');
            if (fileInput) fileInput.value = '';
          }
        }
      }

      saveVehicle(event, vehicleId) {
        event.preventDefault();
        
        const form = event.target;
        const formData = new FormData(form);
        
        const vehicle = {
          lotId: formData.get('lotId'),
          make: formData.get('make'),
          model: formData.get('model'),
          year: parseInt(formData.get('year')),
          bodyType: formData.get('bodyType'),
          fuelType: formData.get('fuelType'),
          transmission: formData.get('transmission'),
          price: parseFloat(formData.get('price')),
          listingType: formData.get('listingType'),
          status: formData.get('status'),
          description: formData.get('description')
        };

        // Add images if uploaded
        if (this.uploadedImages && this.uploadedImages.length > 0) {
          vehicle.images = {
            primary: this.uploadedImages[0].dataUrl,
            gallery: this.uploadedImages.map(img => img.dataUrl)
          };
        } else if (vehicleId) {
          // Keep existing images if updating and no new images
          const existing = appData.vehicles.find(v => v.id === vehicleId);
          if (existing && existing.images) {
            vehicle.images = existing.images;
          }
        }

        if (vehicleId) {
          // Update existing
          const index = appData.vehicles.findIndex(v => v.id === vehicleId);
          if (index !== -1) {
            appData.vehicles[index] = { 
              ...appData.vehicles[index], 
              ...vehicle 
            };
            alert('Vehicle updated successfully');
            this.uploadedImages = null; // Clear uploaded images
            this.navigateTo('vehicle-detail', { vehicleId });
          }
        } else {
          // Add new
          const newVehicle = {
            id: `veh-${Date.now()}`,
            ...vehicle,
            offers: { enabled: false, count: 0, highest: null }
          };
          
          // Add placeholder image if no images uploaded
          if (!newVehicle.images) {
            newVehicle.images = {
              primary: null,
              gallery: []
            };
          }
          
          appData.vehicles.push(newVehicle);
          alert('Vehicle added successfully');
          this.uploadedImages = null; // Clear uploaded images
          this.navigateTo('vehicle-detail', { vehicleId: newVehicle.id });
        }
      }

      // Helper methods
      getDashboardStats() {
        const vehicles = appData.vehicles;
        const lots = appData.lots;
        
        return {
          totalVehicles: vehicles.length,
          liveListings: vehicles.filter(v => v.status === 'live').length,
          draftListings: vehicles.filter(v => v.status === 'draft').length,
          soldListings: vehicles.filter(v => v.status === 'sold').length,
          activeLots: lots.filter(l => l.status === 'live').length
        };
      }

      getListingTypeCounts() {
        const vehicles = appData.vehicles;
        return {
          'trade-silent': vehicles.filter(v => v.listingType === 'trade-silent' && v.status === 'live').length,
          'public-silent': vehicles.filter(v => v.listingType === 'public-silent' && v.status === 'live').length,
          'open': vehicles.filter(v => v.listingType === 'open' && v.status === 'live').length,
          'fixed': vehicles.filter(v => v.listingType === 'fixed' && v.status === 'live').length
        };
      }

      formatPrice(price) {
        return new Intl.NumberFormat('en-GB', {
          style: 'currency',
          currency: 'GBP',
          minimumFractionDigits: 0,
          maximumFractionDigits: 0
        }).format(price);
      }

      getListingTypeLabel(type) {
        const labels = {
          'trade-silent': 'Trade Silent',
          'public-silent': 'Public Silent',
          'open': 'Open Listing',
          'fixed': 'Fixed Price'
        };
        return labels[type] || type;
      }

      getListingTypeDescription(type) {
        const descriptions = {
          'trade-silent': 'Visible to traders only',
          'public-silent': 'Visible publicly, offers hidden',
          'open': 'Standard visible listing',
          'fixed': 'Fixed price, no offers'
        };
        return descriptions[type] || '';
      }

      getStatusBadgeClass(status) {
        const classes = {
          'live': 'badge-success',
          'draft': 'badge-warning',
          'sold': 'badge-secondary'
        };
        return classes[status] || 'badge-secondary';
      }
    }

    // Initialize app
    const app = new CarLinxApp();
  </script>
</body>
</html>