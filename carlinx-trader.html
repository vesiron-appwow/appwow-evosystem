<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CarLinx Trader V2</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-primary: #0a0e1a;
      --bg-secondary: #111827;
      --bg-tertiary: #1f2937;
      --bg-card: #1a1f2e;
      --bg-hover: #252b3f;
      --text-primary: #f9fafb;
      --text-secondary: #d1d5db;
      --text-muted: #9ca3af;
      --accent-primary: #00d9ff;
      --accent-secondary: #00a8ff;
      --accent-glow: rgba(0, 217, 255, 0.1);
      --border-color: rgba(255, 255, 255, 0.1);
      --border-accent: rgba(0, 217, 255, 0.3);
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --info: #3b82f6;
      --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
      --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.4);
      --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.5);
      --shadow-glow: 0 0 20px rgba(0, 217, 255, 0.15);
      --radius-sm: 0.375rem;
      --radius-md: 0.5rem;
      --radius-lg: 0.75rem;
      --transition: all 0.2s ease;
    }

    body {
      font-family: 'Outfit', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-5px) rotate(2deg); }
    }

    @keyframes glow {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    @keyframes confetti {
      0% { transform: translateY(0) scale(1) rotate(0deg); opacity: 1; }
      100% { transform: translateY(-500px) scale(0.5) rotate(720deg); opacity: 0; }
    }

    h1, h2, h3, h4, h5, h6 {
      font-weight: 600;
      line-height: 1.2;
      letter-spacing: -0.02em;
    }

    h1 { font-size: 2rem; }
    h2 { font-size: 1.5rem; }
    h3 { font-size: 1.25rem; }

    .mono {
      font-family: 'JetBrains Mono', monospace;
      letter-spacing: -0.01em;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1rem;
    }

    .page {
      min-height: 100vh;
      padding-bottom: 80px;
    }

    /* MODE SELECTOR BANNER */
    .mode-selector-banner {
      background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
      border-bottom: 1px solid var(--border-color);
      padding: 0.75rem 0;
      position: sticky;
      top: 0;
      z-index: 200;
      backdrop-filter: blur(10px);
      animation: slideIn 0.3s ease;
    }

    .mode-selector-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }

    .mode-label {
      font-size: 0.875rem;
      color: var(--text-muted);
      font-weight: 500;
    }

    .mode-toggle {
      display: flex;
      gap: 0.5rem;
      background: var(--bg-primary);
      padding: 0.25rem;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-color);
    }

    .mode-btn {
      padding: 0.5rem 1rem;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      font-family: 'Outfit', sans-serif;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      border-radius: var(--radius-sm);
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .mode-btn:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .mode-btn.active {
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      color: var(--bg-primary);
      box-shadow: 0 2px 8px rgba(0, 217, 255, 0.3);
    }

    .header {
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
      padding: 1rem 0;
      position: sticky;
      top: 48px;
      z-index: 100;
      backdrop-filter: blur(10px);
    }

    .header-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 1rem;
    }

    .logo {
      font-size: 1.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.03em;
    }

    .nav-bottom {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--bg-secondary);
      border-top: 1px solid var(--border-color);
      padding: 0.5rem;
      z-index: 100;
      backdrop-filter: blur(10px);
    }

    .nav-bottom.hidden {
      display: none;
    }

    .nav-items {
      display: flex;
      justify-content: space-around;
      align-items: center;
      max-width: 600px;
      margin: 0 auto;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.25rem;
      padding: 0.5rem 1rem;
      color: var(--text-muted);
      text-decoration: none;
      font-size: 0.75rem;
      font-weight: 500;
      transition: var(--transition);
      border-radius: var(--radius-sm);
      cursor: pointer;
      background: transparent;
      border: none;
    }

    .nav-item:hover {
      background: var(--bg-hover);
      color: var(--text-secondary);
    }

    .nav-item.active {
      color: var(--accent-primary);
      background: var(--accent-glow);
    }

    .nav-icon {
      font-size: 1.5rem;
    }

    .card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      transition: var(--transition);
    }

    .card:hover {
      border-color: var(--border-accent);
      box-shadow: var(--shadow-glow);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
      margin: 1.5rem 0;
    }

    .stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      padding: 1.25rem;
      transition: var(--transition);
    }

    .stat-card:hover {
      border-color: var(--border-accent);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .stat-label {
      font-size: 0.875rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.5rem;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--accent-primary);
      font-family: 'JetBrains Mono', monospace;
    }

    /* LINK3 STYLES */
    .link3-section {
      background: linear-gradient(135deg, var(--bg-card), var(--bg-tertiary));
      border: 1px solid var(--border-accent);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      margin: 2rem 0;
    }

    .link3-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }

    .link3-icon {
      font-size: 2rem;
      filter: drop-shadow(0 0 8px rgba(0, 217, 255, 0.5));
    }

    .link3-stages {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1rem;
      margin-top: 1rem;
    }

    .link3-stage-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      padding: 1rem;
      display: flex;
      align-items: center;
      gap: 1rem;
      transition: var(--transition);
    }

    .link3-stage-card:hover {
      border-color: var(--border-accent);
      transform: translateX(4px);
    }

    .stage-number {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1.25rem;
      flex-shrink: 0;
    }

    .stage-1 { background: rgba(16, 185, 129, 0.2); color: var(--success); border: 2px solid var(--success); }
    .stage-2 { background: rgba(245, 158, 11, 0.2); color: var(--warning); border: 2px solid var(--warning); }
    .stage-3 { background: rgba(59, 130, 246, 0.2); color: var(--info); border: 2px solid var(--info); }

    .stage-info {
      flex: 1;
    }

    .stage-title {
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .stage-description {
      font-size: 0.875rem;
      color: var(--text-muted);
    }

    .stage-count {
      text-align: center;
      min-width: 60px;
    }

    .stage-count-value {
      font-size: 1.5rem;
      font-weight: 700;
      font-family: 'JetBrains Mono', monospace;
    }

    .stage-count-label {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: var(--radius-md);
      font-size: 0.875rem;
      font-weight: 600;
      font-family: 'Outfit', sans-serif;
      cursor: pointer;
      transition: var(--transition);
      text-decoration: none;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      color: var(--bg-primary);
      box-shadow: 0 4px 12px rgba(0, 217, 255, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 217, 255, 0.4);
    }

    .btn-secondary {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
    }

    .btn-secondary:hover {
      background: var(--bg-hover);
      border-color: var(--border-accent);
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-secondary);
    }

    .btn-ghost:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .btn-sm {
      padding: 0.5rem 1rem;
      font-size: 0.75rem;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.375rem 0.75rem;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .badge-success {
      background: rgba(16, 185, 129, 0.15);
      color: var(--success);
      border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .badge-warning {
      background: rgba(245, 158, 11, 0.15);
      color: var(--warning);
      border: 1px solid rgba(245, 158, 11, 0.3);
    }

    .badge-info {
      background: rgba(59, 130, 246, 0.15);
      color: var(--info);
      border: 1px solid rgba(59, 130, 246, 0.3);
    }

    .badge-secondary {
      background: rgba(160, 174, 192, 0.15);
      color: var(--text-secondary);
      border: 1px solid var(--border-color);
    }

    .badge-danger {
      background: rgba(239, 68, 68, 0.15);
      color: var(--danger);
      border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .vehicle-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1rem;
      margin: 1rem 0;
    }

    .vehicle-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      overflow: hidden;
      transition: var(--transition);
      cursor: pointer;
      position: relative;
    }

    .vehicle-card:hover {
      border-color: var(--border-accent);
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }

    .vehicle-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
      background: linear-gradient(135deg, var(--bg-tertiary), var(--bg-secondary));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      color: var(--text-muted);
    }

    .vehicle-content {
      padding: 1.25rem;
    }

    .vehicle-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 1rem;
    }

    .vehicle-title {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .vehicle-year {
      color: var(--text-muted);
      font-size: 0.875rem;
    }

    .vehicle-price {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent-primary);
      font-family: 'JetBrains Mono', monospace;
    }

    .vehicle-details {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin: 1rem 0;
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .vehicle-detail-item {
      display: flex;
      align-items: center;
      gap: 0.375rem;
    }

    .vehicle-badges {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-top: 1rem;
    }

    .lot-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1rem;
    }

    .lot-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      transition: var(--transition);
      cursor: pointer;
    }

    .lot-card:hover {
      border-color: var(--border-accent);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .lot-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 1rem;
    }

    .lot-title {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .lot-location {
      color: var(--text-muted);
      font-size: 0.875rem;
    }

    .lot-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      margin-top: 1rem;
    }

    .lot-stat {
      text-align: center;
    }

    .lot-stat-label {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .lot-stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent-primary);
      font-family: 'JetBrains Mono', monospace;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--text-secondary);
    }

    .form-input, .form-select, .form-textarea {
      width: 100%;
      padding: 0.75rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-family: 'Outfit', sans-serif;
      font-size: 1rem;
      transition: var(--transition);
    }

    .form-input:focus, .form-select:focus, .form-textarea:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px var(--accent-glow);
    }

    .form-textarea {
      min-height: 120px;
      resize: vertical;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .form-help {
      font-size: 0.875rem;
      color: var(--text-muted);
      margin-top: 0.25rem;
    }

    .radio-group {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .radio-option {
      display: flex;
      align-items: start;
      gap: 0.75rem;
      padding: 1rem;
      background: var(--bg-secondary);
      border: 2px solid var(--border-color);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: var(--transition);
    }

    .radio-option:hover {
      border-color: var(--border-accent);
      background: var(--bg-hover);
    }

    .radio-option input[type="radio"] {
      margin-top: 0.25rem;
    }

    .radio-option input[type="radio"]:checked + .radio-content {
      color: var(--accent-primary);
    }

    .radio-option:has(input:checked) {
      border-color: var(--accent-primary);
      background: var(--accent-glow);
    }

    .radio-content {
      flex: 1;
    }

    .radio-title {
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .radio-description {
      font-size: 0.875rem;
      color: var(--text-muted);
    }

    .image-upload-area {
      border: 2px dashed var(--border-color);
      border-radius: var(--radius-md);
      padding: 2rem;
      text-align: center;
      background: var(--bg-secondary);
      transition: var(--transition);
      cursor: pointer;
    }

    .image-upload-area:hover {
      border-color: var(--accent-primary);
      background: var(--accent-glow);
    }

    .image-preview-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .image-preview {
      position: relative;
      aspect-ratio: 1;
      border-radius: var(--radius-sm);
      overflow: hidden;
      border: 1px solid var(--border-color);
    }

    .image-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .image-preview-remove {
      position: absolute;
      top: 0.25rem;
      right: 0.25rem;
      background: var(--danger);
      color: white;
      border: none;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 0.75rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .empty-state {
      text-align: center;
      padding: 3rem 1rem;
      color: var(--text-muted);
    }

    .empty-state-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.3;
    }

    .hidden {
      display: none !important;
    }

    .mt-2 { margin-top: 1rem; }
    .mt-3 { margin-top: 1.5rem; }
    .mb-2 { margin-bottom: 1rem; }

    @media (min-width: 768px) {
      .vehicle-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .stats-grid {
        grid-template-columns: repeat(4, 1fr);
      }

      .link3-stages {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (min-width: 1024px) {
      .vehicle-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-secondary);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--bg-tertiary);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--bg-hover);
    }

    ::selection {
      background: var(--accent-primary);
      color: var(--bg-primary);
    }
  </style>
</head>
<body>
  <!-- Mode Selector Banner -->
  <div class="mode-selector-banner">
    <div class="mode-selector-content">
      <span class="mode-label">View Mode:</span>
      <div class="mode-toggle">
        <button class="mode-btn" data-mode="public" onclick="app.switchMode('public')">
          <span>üëÅÔ∏è</span>
          <span>Public Facing</span>
        </button>
        <button class="mode-btn active" data-mode="admin" onclick="app.switchMode('admin')">
          <span>üîß</span>
          <span>Trader Admin</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <div class="logo">CarLinx Trader</div>
      <div>
        <button class="btn btn-ghost btn-sm" style="padding: 0.5rem;" title="Notifications">üîî</button>
      </div>
    </div>
  </header>

  <!-- Main Content Area -->
  <main id="app-content" class="page">
    <!-- Content will be dynamically loaded here -->
  </main>

  <!-- Bottom Navigation -->
  <nav class="nav-bottom" id="admin-nav">
    <div class="nav-items">
      <button class="nav-item active" data-view="dashboard">
        <span class="nav-icon">üìä</span>
        <span>Dashboard</span>
      </button>
      <button class="nav-item" data-view="lots">
        <span class="nav-icon">üè¢</span>
        <span>Lots</span>
      </button>
      <button class="nav-item" data-view="vehicles">
        <span class="nav-icon">üöó</span>
        <span>Vehicles</span>
      </button>
      <button class="nav-item" data-view="consumer">
        <span class="nav-icon">üëÅÔ∏è</span>
        <span>Consumer</span>
      </button>
    </div>
  </nav>

  <script>
    // ===== DATA =====
    const appData = {
      trader: {
        id: "trader-001",
        name: "Brighton Auto Traders",
        location: { town: "Brighton", postcode: "BN1" }
      },
      lots: [
        {
          id: "lot-001",
          name: "Brighton Used Cars",
          location: { town: "Brighton", postcode: "BN1" },
          lotType: "used",
          status: "live",
          vehicleIds: ["veh-001", "veh-002", "veh-004"]
        },
        {
          id: "lot-002",
          name: "Prestige Selection",
          location: { town: "Brighton", postcode: "BN2" },
          lotType: "mixed",
          status: "live",
          vehicleIds: ["veh-003", "veh-005"]
        },
        {
          id: "lot-003",
          name: "Commercial Fleet",
          location: { town: "Hove", postcode: "BN3" },
          lotType: "used",
          status: "live",
          vehicleIds: ["veh-006"]
        }
      ],
      vehicles: [
        {
          id: "veh-001",
          lotId: "lot-001",
          make: "Ford",
          model: "Focus",
          year: 2018,
          bodyType: "Hatchback",
          fuelType: "Petrol",
          transmission: "Manual",
          price: 8495,
          listingType: "link3-auto",
          link3Stage: "top-buyers",
          link3StartDate: new Date(Date.now() - 86400000).toISOString(), // Started 1 day ago
          status: "live",
          description: "Well maintained Ford Focus with full service history. Ideal family hatchback with low mileage.",
          offers: { enabled: true, count: 3, highest: 8100 }
        },
        {
          id: "veh-002",
          lotId: "lot-001",
          make: "Volkswagen",
          model: "Golf",
          year: 2017,
          bodyType: "Hatchback",
          fuelType: "Diesel",
          transmission: "Automatic",
          price: 9295,
          listingType: "link3-auto",
          link3Stage: "base-buyers",
          link3StartDate: new Date(Date.now() - 4 * 86400000).toISOString(), // Started 4 days ago
          status: "live",
          description: "Smooth automatic Golf, ideal motorway car. Recent service and new tyres.",
          offers: { enabled: true, count: 1, highest: 9000 }
        },
        {
          id: "veh-003",
          lotId: "lot-002",
          make: "BMW",
          model: "3 Series",
          year: 2019,
          bodyType: "Saloon",
          fuelType: "Diesel",
          transmission: "Automatic",
          price: 16995,
          listingType: "link3-manual",
          link3Stage: "public-classified",
          link3StartDate: new Date(Date.now() - 10 * 86400000).toISOString(), // Started 10 days ago
          status: "live",
          description: "Premium executive saloon with comprehensive service history.",
          offers: { enabled: true, count: 7, highest: 16500 }
        },
        {
          id: "veh-004",
          lotId: "lot-001",
          make: "Toyota",
          model: "Yaris",
          year: 2019,
          bodyType: "Hatchback",
          fuelType: "Hybrid",
          transmission: "Automatic",
          price: 11495,
          listingType: "open",
          status: "live",
          description: "Economical hybrid with low running costs and city-friendly size.",
          offers: { enabled: true, count: 2, highest: 11200 }
        },
        {
          id: "veh-005",
          lotId: "lot-002",
          make: "Audi",
          model: "A4",
          year: 2020,
          bodyType: "Saloon",
          fuelType: "Diesel",
          transmission: "Automatic",
          price: 19995,
          listingType: "link3-auto",
          link3Stage: "top-buyers",
          link3StartDate: new Date(Date.now() - 2 * 86400000).toISOString(), // Started 2 days ago
          status: "live",
          description: "Executive saloon with full leather interior and tech package.",
          offers: { enabled: true, count: 5, highest: 19500 }
        },
        {
          id: "veh-006",
          lotId: "lot-003",
          make: "Ford",
          model: "Transit",
          year: 2018,
          bodyType: "Van",
          fuelType: "Diesel",
          transmission: "Manual",
          price: 12995,
          listingType: "trade-silent",
          status: "live",
          description: "Reliable commercial van with full service history.",
          offers: { enabled: true, count: 0, highest: null }
        }
      ]
    };

    // ===== APP LOGIC =====
    class CarLinxApp {
      constructor() {
        this.currentView = 'dashboard';
        this.currentVehicle = null;
        this.editingVehicle = null;
        this.uploadedImages = null;
        this.currentMode = 'admin'; // 'admin' or 'public'
        this.init();
      }

      init() {
        this.setupNavigation();
        this.renderView('dashboard');
      }

      setupNavigation() {
        document.querySelectorAll('.nav-item').forEach(item => {
          item.addEventListener('click', (e) => {
            const view = e.currentTarget.dataset.view;
            this.navigateTo(view);
          });
        });
      }

      switchMode(mode) {
        this.currentMode = mode;
        
        // Update mode buttons
        document.querySelectorAll('.mode-btn').forEach(btn => {
          btn.classList.toggle('active', btn.dataset.mode === mode);
        });

        // Show/hide admin navigation
        const adminNav = document.getElementById('admin-nav');
        if (mode === 'public') {
          adminNav.classList.add('hidden');
          this.navigateTo('consumer');
        } else {
          adminNav.classList.remove('hidden');
          this.navigateTo('dashboard');
        }
      }

      navigateTo(view, data = {}) {
        // Update active nav
        document.querySelectorAll('.nav-item').forEach(item => {
          item.classList.remove('active');
          if (item.dataset.view === view) {
            item.classList.add('active');
          }
        });

        this.currentView = view;
        if (data.vehicleId) this.currentVehicle = data.vehicleId;
        if (data.editVehicleId !== undefined) this.editingVehicle = data.editVehicleId;

        this.renderView(view, data);
        window.scrollTo(0, 0);
      }

      renderView(view, data = {}) {
        const content = document.getElementById('app-content');
        
        switch(view) {
          case 'dashboard':
            content.innerHTML = this.renderDashboard();
            break;
          case 'lots':
            content.innerHTML = this.renderLots();
            this.attachLotHandlers();
            break;
          case 'vehicles':
            content.innerHTML = this.renderVehicles(data.lotId);
            this.attachVehicleHandlers();
            break;
          case 'vehicle-detail':
            content.innerHTML = this.renderVehicleDetail(this.currentVehicle);
            this.attachDetailHandlers();
            break;
          case 'vehicle-edit':
            content.innerHTML = this.renderVehicleEdit(this.editingVehicle);
            this.attachEditHandlers();
            break;
          case 'consumer':
            content.innerHTML = this.renderConsumerView();
            break;
        }
      }

      renderDashboard() {
        const stats = this.getDashboardStats();
        const listingTypes = this.getListingTypeCounts();
        const link3Stats = this.getLink3Stats();

        return `
          <div class="container">
            <section style="margin: 2rem 0;">
              <h1>${appData.trader.name}</h1>
              <p style="color: var(--text-muted);">${appData.trader.location.town}, ${appData.trader.location.postcode}</p>
            </section>

            <section>
              <h2 style="margin-bottom: 1rem;">Overview</h2>
              <div class="stats-grid">
                <div class="stat-card">
                  <div class="stat-label">Total Vehicles</div>
                  <div class="stat-value">${stats.totalVehicles}</div>
                </div>
                <div class="stat-card">
                  <div class="stat-label">Live</div>
                  <div class="stat-value">${stats.liveListings}</div>
                </div>
                <div class="stat-card">
                  <div class="stat-label">Draft</div>
                  <div class="stat-value">${stats.draftListings}</div>
                </div>
                <div class="stat-card">
                  <div class="stat-label">Active Lots</div>
                  <div class="stat-value">${stats.activeLots}</div>
                </div>
              </div>
            </section>

            <!-- Link3 Section -->
            <section class="link3-section">
              <div class="link3-header">
                <span class="link3-icon">üîó</span>
                <div>
                  <h2 style="margin: 0;">Link3 Automated Selling</h2>
                  <p style="color: var(--text-muted); font-size: 0.875rem; margin-top: 0.25rem;">
                    3-stage automated progression: Top Buyers (3d) ‚Üí Base Buyers (3d) ‚Üí Public (28d)
                  </p>
                </div>
              </div>

              <div class="link3-stages">
                <div class="link3-stage-card">
                  <div class="stage-number stage-1">1</div>
                  <div class="stage-info">
                    <div class="stage-title" style="color: var(--success);">Top Tier Buyers</div>
                    <div class="stage-description">3 days exclusive access</div>
                  </div>
                  <div class="stage-count">
                    <div class="stage-count-value" style="color: var(--success);">${link3Stats.topBuyers}</div>
                    <div class="stage-count-label">Active</div>
                  </div>
                </div>

                <div class="link3-stage-card">
                  <div class="stage-number stage-2">2</div>
                  <div class="stage-info">
                    <div class="stage-title" style="color: var(--warning);">Base Buyers</div>
                    <div class="stage-description">3 days expanded access</div>
                  </div>
                  <div class="stage-count">
                    <div class="stage-count-value" style="color: var(--warning);">${link3Stats.baseBuyers}</div>
                    <div class="stage-count-label">Active</div>
                  </div>
                </div>

                <div class="link3-stage-card">
                  <div class="stage-number stage-3">3</div>
                  <div class="stage-info">
                    <div class="stage-title" style="color: var(--info);">Public Classified</div>
                    <div class="stage-description">28 days public listing</div>
                  </div>
                  <div class="stage-count">
                    <div class="stage-count-value" style="color: var(--info);">${link3Stats.publicClassified}</div>
                    <div class="stage-count-label">Active</div>
                  </div>
                </div>
              </div>

              <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color); display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; text-align: center;">
                <div>
                  <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent-primary); font-family: 'JetBrains Mono', monospace;">
                    ${link3Stats.totalActive}
                  </div>
                  <div style="font-size: 0.875rem; color: var(--text-muted);">Total in Link3 Process</div>
                </div>
                <div>
                  <div style="font-size: 1.5rem; font-weight: 700; color: var(--success); font-family: 'JetBrains Mono', monospace;">
                    ${link3Stats.sold}
                  </div>
                  <div style="font-size: 0.875rem; color: var(--text-muted);">Sold via Link3</div>
                </div>
              </div>
            </section>

            <section style="margin-top: 2rem;">
              <h2 style="margin-bottom: 1rem;">Marketplace Modes</h2>
              <div style="display: grid; grid-template-columns: 1fr; gap: 1rem;">
                <div class="card">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                    <span style="font-weight: 600;">üîá Trade Silent</span>
                    <span class="mono" style="font-size: 1.25rem; color: var(--accent-primary);">${listingTypes['trade-silent']}</span>
                  </div>
                  <p style="font-size: 0.875rem; color: var(--text-muted);">Reserved for trade buyers only</p>
                </div>

                <div class="card">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                    <span style="font-weight: 600;">ü§´ Public Silent</span>
                    <span class="mono" style="font-size: 1.25rem; color: var(--accent-primary);">${listingTypes['public-silent']}</span>
                  </div>
                  <p style="font-size: 0.875rem; color: var(--text-muted);">Best offer accepted within timeframe</p>
                </div>

                <div class="card">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                    <span style="font-weight: 600;">üì£ Open Offers</span>
                    <span class="mono" style="font-size: 1.25rem; color: var(--accent-primary);">${listingTypes['open']}</span>
                  </div>
                  <p style="font-size: 0.875rem; color: var(--text-muted);">Public bidding with visible offers</p>
                </div>

                <div class="card">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                    <span style="font-weight: 600;">üí∑ Fixed Price</span>
                    <span class="mono" style="font-size: 1.25rem; color: var(--accent-primary);">${listingTypes['fixed']}</span>
                  </div>
                  <p style="font-size: 0.875rem; color: var(--text-muted);">No offers accepted</p>
                </div>
              </div>
            </section>

            <section style="margin-top: 2rem;">
              <h2 style="margin-bottom: 1rem;">Quick Actions</h2>
              <div style="display: grid; grid-template-columns: 1fr; gap: 1rem;">
                <button class="btn btn-primary" onclick="app.navigateTo('vehicle-edit', {editVehicleId: null})">
                  ‚ûï Add New Vehicle
                </button>
                <button class="btn btn-secondary" onclick="app.navigateTo('vehicles')">
                  üìã View All Vehicles
                </button>
                <button class="btn btn-secondary" onclick="app.navigateTo('consumer')">
                  üëÅÔ∏è Consumer View
                </button>
              </div>
            </section>
          </div>
        `;
      }

      renderLots() {
        const lots = appData.lots;

        if (lots.length === 0) {
          return this.renderEmptyState('No lots found', 'Create your first lot to get started');
        }

        const lotsHtml = lots.map(lot => {
          const vehicles = appData.vehicles.filter(v => v.lotId === lot.id);
          const liveVehicles = vehicles.filter(v => v.status === 'live').length;
          
          return `
            <div class="lot-card" data-lot-id="${lot.id}">
              <div class="lot-header">
                <div>
                  <h3 class="lot-title">${lot.name}</h3>
                  <div class="lot-location">${lot.location.town}, ${lot.location.postcode}</div>
                </div>
                <span class="badge ${lot.status === 'live' ? 'badge-success' : 'badge-secondary'}">
                  ${lot.status}
                </span>
              </div>
              <div class="lot-stats">
                <div class="lot-stat">
                  <div class="lot-stat-label">Type</div>
                  <div class="lot-stat-value" style="font-size: 1rem; color: var(--text-secondary);">
                    ${lot.lotType}
                  </div>
                </div>
                <div class="lot-stat">
                  <div class="lot-stat-label">Vehicles</div>
                  <div class="lot-stat-value">${vehicles.length}</div>
                </div>
                <div class="lot-stat">
                  <div class="lot-stat-label">Live</div>
                  <div class="lot-stat-value">${liveVehicles}</div>
                </div>
              </div>
            </div>
          `;
        }).join('');

        return `
          <div class="container">
            <section style="margin: 2rem 0;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h1>Car Lots</h1>
                <button class="btn btn-primary btn-sm" onclick="alert('Add lot feature coming soon')">
                  ‚ûï Add Lot
                </button>
              </div>
              <p style="color: var(--text-muted);">Manage your vehicle lot locations and inventory</p>
            </section>

            <section>
              <div class="lot-grid">
                ${lotsHtml}
              </div>
            </section>
          </div>
        `;
      }

      renderVehicles(filterLotId = null) {
        let vehicles = appData.vehicles;
        let pageTitle = 'All Vehicles';

        if (filterLotId) {
          vehicles = vehicles.filter(v => v.lotId === filterLotId);
          const lot = appData.lots.find(l => l.id === filterLotId);
          pageTitle = lot ? `${lot.name} - Vehicles` : 'Lot Vehicles';
        }

        const vehiclesHtml = this.renderVehicleCards(vehicles, false);

        return `
          <div class="container">
            <section style="margin: 2rem 0;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h1>${pageTitle}</h1>
                <button class="btn btn-primary btn-sm" onclick="app.navigateTo('vehicle-edit', {editVehicleId: null})">
                  ‚ûï Add Vehicle
                </button>
              </div>
              <p style="color: var(--text-muted);">Manage your vehicle inventory and listings</p>
            </section>

            <section>
              <div class="vehicle-grid">
                ${vehiclesHtml}
              </div>
            </section>
          </div>
        `;
      }

      renderVehicleDetail(vehicleId) {
        const vehicle = appData.vehicles.find(v => v.id === vehicleId);
        
        if (!vehicle) {
          return this.renderEmptyState('Vehicle not found', 'This vehicle may have been removed');
        }

        const lot = appData.lots.find(l => l.id === vehicle.lotId);
        const link3Info = this.getLink3Info(vehicle);

        return `
          <div class="container">
            <section style="margin: 1.5rem 0;">
              <button class="btn btn-ghost btn-sm" onclick="app.navigateTo('vehicles')">
                ‚Üê Back to Vehicles
              </button>
            </section>

            <section style="margin-bottom: 2rem;">
              <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                <div>
                  <h1>${vehicle.year} ${vehicle.make} ${vehicle.model}</h1>
                  <p style="color: var(--text-muted);">${lot ? lot.name : 'Unknown Lot'}</p>
                </div>
                <div style="text-align: right;">
                  <div class="vehicle-price">¬£${vehicle.price.toLocaleString()}</div>
                  <span class="badge ${vehicle.status === 'live' ? 'badge-success' : vehicle.status === 'sold' ? 'badge-secondary' : 'badge-warning'}">
                    ${vehicle.status}
                  </span>
                </div>
              </div>

              ${vehicle.images && vehicle.images.primary ? `
                <img src="${vehicle.images.primary}" alt="${vehicle.make} ${vehicle.model}" style="width: 100%; height: 400px; object-fit: cover; border-radius: var(--radius-lg); margin-bottom: 1.5rem;">
              ` : `
                <div class="vehicle-image" style="height: 400px; margin-bottom: 1.5rem;">
                  üöó
                </div>
              `}

              ${link3Info.isLink3 ? `
                <div class="link3-section" style="margin-bottom: 1.5rem;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3>üîó Link3 Status</h3>
                    <span class="badge ${link3Info.isAuto ? 'badge-info' : 'badge-warning'}">
                      ${link3Info.isAuto ? '‚ö° Auto' : '‚úã Manual'}
                    </span>
                  </div>

                  <div style="background: var(--bg-secondary); padding: 1.25rem; border-radius: var(--radius-md); border: 1px solid var(--border-color);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                      <span style="font-weight: 600;">Current Stage:</span>
                      <span class="${link3Info.stageBadgeClass}">${link3Info.stageName}</span>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                      <span style="color: var(--text-muted); font-size: 0.875rem;">Time Remaining:</span>
                      <span style="font-weight: 600; color: var(--accent-primary);">${link3Info.daysRemaining} days</span>
                    </div>

                    ${link3Info.nextStage ? `
                      <div style="padding-top: 0.75rem; border-top: 1px solid var(--border-color); color: var(--text-muted); font-size: 0.875rem;">
                        Next: ${link3Info.nextStage} ${link3Info.isAuto ? '(automatic)' : '(manual trigger required)'}
                      </div>
                    ` : ''}
                  </div>
                </div>
              ` : ''}

              <div class="card">
                <h3 style="margin-bottom: 1rem;">Vehicle Details</h3>
                <div class="vehicle-details" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                  <div>
                    <div style="color: var(--text-muted); font-size: 0.875rem;">Body Type</div>
                    <div style="font-weight: 600;">${vehicle.bodyType}</div>
                  </div>
                  <div>
                    <div style="color: var(--text-muted); font-size: 0.875rem;">Fuel</div>
                    <div style="font-weight: 600;">${vehicle.fuelType}</div>
                  </div>
                  <div>
                    <div style="color: var(--text-muted); font-size: 0.875rem;">Transmission</div>
                    <div style="font-weight: 600;">${vehicle.transmission}</div>
                  </div>
                  <div>
                    <div style="color: var(--text-muted); font-size: 0.875rem;">Listing Type</div>
                    <div style="font-weight: 600;">${this.getListingTypeLabel(vehicle.listingType)}</div>
                  </div>
                </div>

                ${vehicle.description ? `
                  <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color);">
                    <h4 style="margin-bottom: 0.5rem;">Description</h4>
                    <p style="color: var(--text-secondary); line-height: 1.6;">${vehicle.description}</p>
                  </div>
                ` : ''}
              </div>

              ${vehicle.offers.enabled ? `
                <div class="card mt-2">
                  <h3 style="margin-bottom: 1rem;">Offers</h3>
                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div>
                      <div style="color: var(--text-muted); font-size: 0.875rem;">Total Offers</div>
                      <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent-primary);">${vehicle.offers.count}</div>
                    </div>
                    <div>
                      <div style="color: var(--text-muted); font-size: 0.875rem;">Highest Offer</div>
                      <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent-primary);">
                        ${vehicle.offers.highest ? `¬£${vehicle.offers.highest.toLocaleString()}` : '-'}
                      </div>
                    </div>
                  </div>
                </div>
              ` : ''}

              <div style="margin-top: 2rem; display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <button class="btn btn-primary" onclick="app.navigateTo('vehicle-edit', {editVehicleId: '${vehicle.id}'})">
                  ‚úèÔ∏è Edit Vehicle
                </button>
                <button class="btn btn-secondary" onclick="app.deleteVehicle('${vehicle.id}')">
                  üóëÔ∏è Delete Vehicle
                </button>
              </div>
            </section>
          </div>
        `;
      }

      renderVehicleEdit(vehicleId) {
        const vehicle = vehicleId ? appData.vehicles.find(v => v.id === vehicleId) : null;
        const isNew = !vehicle;
        const pageTitle = isNew ? 'Add Vehicle' : 'Edit Vehicle';

        const formData = vehicle || {
          make: '',
          model: '',
          year: '',
          price: '',
          bodyType: '',
          fuelType: '',
          transmission: '',
          description: '',
          lotId: '',
          listingType: 'link3-auto',
          link3Stage: 'draft',
          status: 'draft'
        };

        return `
          <div class="container">
            <section style="margin: 1.5rem 0;">
              <button class="btn btn-ghost btn-sm" onclick="app.navigateTo(app.currentVehicle ? 'vehicle-detail' : 'vehicles')">
                ‚Üê Back
              </button>
            </section>

            <section style="margin-bottom: 2rem;">
              <h1>${pageTitle}</h1>
              <p style="color: var(--text-muted);">Update vehicle information and listing settings</p>
            </section>

            <form id="vehicle-form" onsubmit="app.saveVehicle(event, '${vehicleId || ''}')">
              <section style="margin-bottom: 2rem;">
                <h2 style="margin-bottom: 1rem;">Vehicle Information</h2>
                
                <div class="form-group">
                  <label class="form-label">Lot</label>
                  <select name="lotId" class="form-select" required>
                    <option value="">Select lot</option>
                    ${appData.lots.map(lot => 
                      `<option value="${lot.id}" ${formData.lotId === lot.id ? 'selected' : ''}>${lot.name}</option>`
                    ).join('')}
                  </select>
                </div>

                <div class="form-group">
                  <label class="form-label">Make</label>
                  <input type="text" name="make" class="form-input" value="${formData.make}" required placeholder="e.g. Ford">
                </div>

                <div class="form-group">
                  <label class="form-label">Model</label>
                  <input type="text" name="model" class="form-input" value="${formData.model}" required placeholder="e.g. Focus">
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label">Year</label>
                    <input type="number" name="year" class="form-input" value="${formData.year}" required placeholder="2018" min="1990" max="2026">
                  </div>

                  <div class="form-group">
                    <label class="form-label">Price (¬£)</label>
                    <input type="number" name="price" class="form-input" value="${formData.price}" required placeholder="8495" min="0" step="1">
                  </div>
                </div>

                <div class="form-group">
                  <label class="form-label">Body Type</label>
                  <select name="bodyType" class="form-select" required>
                    <option value="">Select body type</option>
                    ${['Hatchback', 'Saloon', 'Estate', 'SUV', 'Coupe', 'Convertible', 'Van', 'MPV'].map(type => 
                      `<option value="${type}" ${formData.bodyType === type ? 'selected' : ''}>${type}</option>`
                    ).join('')}
                  </select>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label">Fuel Type</label>
                    <select name="fuelType" class="form-select" required>
                      <option value="">Select fuel</option>
                      ${['Petrol', 'Diesel', 'Hybrid', 'Electric', 'Plug-in Hybrid'].map(type => 
                        `<option value="${type}" ${formData.fuelType === type ? 'selected' : ''}>${type}</option>`
                      ).join('')}
                    </select>
                  </div>

                  <div class="form-group">
                    <label class="form-label">Transmission</label>
                    <select name="transmission" class="form-select" required>
                      <option value="">Select transmission</option>
                      <option value="Manual" ${formData.transmission === 'Manual' ? 'selected' : ''}>Manual</option>
                      <option value="Automatic" ${formData.transmission === 'Automatic' ? 'selected' : ''}>Automatic</option>
                    </select>
                  </div>
                </div>

                <div class="form-group">
                  <label class="form-label">Description</label>
                  <textarea name="description" class="form-textarea" placeholder="Enter vehicle description...">${formData.description}</textarea>
                </div>
              </section>

              <section style="margin-bottom: 2rem;">
                <h2 style="margin-bottom: 1rem;">üîó Link3 Listing Configuration</h2>
                
                <div class="form-group">
                  <label class="form-label">Link3 Mode</label>
                  <div class="radio-group">
                    <label class="radio-option">
                      <input type="radio" name="listingType" value="link3-auto" ${formData.listingType === 'link3-auto' ? 'checked' : ''} onchange="app.toggleLink3Manual(false)">
                      <div class="radio-content">
                        <div class="radio-title">‚ö° Link3 Auto</div>
                        <div class="radio-description">Automatically progress through stages: Top Buyers (3d) ‚Üí Base Buyers (3d) ‚Üí Public (28d)</div>
                      </div>
                    </label>

                    <label class="radio-option">
                      <input type="radio" name="listingType" value="link3-manual" ${formData.listingType === 'link3-manual' ? 'checked' : ''} onchange="app.toggleLink3Manual(true)">
                      <div class="radio-content">
                        <div class="radio-title">‚úã Link3 Manual</div>
                        <div class="radio-description">Manually control when to move between stages</div>
                      </div>
                    </label>

                    <label class="radio-option">
                      <input type="radio" name="listingType" value="open" ${formData.listingType === 'open' ? 'checked' : ''} onchange="app.toggleLink3Manual(false)">
                      <div class="radio-content">
                        <div class="radio-title">üì£ Traditional Listing</div>
                        <div class="radio-description">Standard open offers or fixed price listing (not Link3)</div>
                      </div>
                    </label>
                  </div>
                </div>

                <div id="link3-manual-options" class="form-group ${formData.listingType === 'link3-manual' ? '' : 'hidden'}">
                  <label class="form-label">Starting Stage (Manual Mode Only)</label>
                  <select name="link3Stage" class="form-select">
                    <option value="draft">Draft (not yet listed)</option>
                    <option value="top-buyers" ${formData.link3Stage === 'top-buyers' ? 'selected' : ''}>Stage 1: Top Tier Buyers</option>
                    <option value="base-buyers" ${formData.link3Stage === 'base-buyers' ? 'selected' : ''}>Stage 2: Base Buyers</option>
                    <option value="public-classified" ${formData.link3Stage === 'public-classified' ? 'selected' : ''}>Stage 3: Public Classified</option>
                  </select>
                  <div class="form-help">Select which stage to start at when publishing</div>
                </div>
              </section>

              <section style="margin-bottom: 2rem;">
                <h2 style="margin-bottom: 1rem;">Status</h2>
                
                <div class="form-group">
                  <label class="form-label">Listing Status</label>
                  <select name="status" class="form-select" required>
                    <option value="draft" ${formData.status === 'draft' ? 'selected' : ''}>Draft</option>
                    <option value="live" ${formData.status === 'live' ? 'selected' : ''}>Live</option>
                    <option value="sold" ${formData.status === 'sold' ? 'selected' : ''}>Sold</option>
                  </select>
                </div>
              </section>

              <section style="margin-bottom: 2rem;">
                <h2 style="margin-bottom: 1rem;">Images</h2>
                <div class="form-group">
                  <div class="image-upload-area" onclick="document.getElementById('image-upload').click()">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">üì∑</div>
                    <div style="font-weight: 600; margin-bottom: 0.25rem;">Upload Vehicle Images</div>
                    <div style="font-size: 0.875rem; color: var(--text-muted);">Click to select images</div>
                  </div>
                  <input type="file" id="image-upload" accept="image/*" multiple style="display: none;" onchange="app.handleImageUpload(event)">
                  
                  <div id="image-preview-container" class="image-preview-grid"></div>
                </div>
              </section>

              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <button type="button" class="btn btn-secondary" onclick="app.navigateTo(app.currentVehicle ? 'vehicle-detail' : 'vehicles')">
                  Cancel
                </button>
                <button type="submit" class="btn btn-primary">
                  üíæ Save Vehicle
                </button>
              </div>
            </form>
          </div>
        `;
      }

      renderConsumerView() {
        const liveVehicles = appData.vehicles.filter(v => v.status === 'live');
        const vehiclesHtml = this.renderVehicleCards(liveVehicles, true);

        return `
          <div class="container">
            <section style="margin: 2rem 0; text-align: center;">
              <h1>Browse Our Vehicles</h1>
              <p style="color: var(--text-muted); margin-top: 0.5rem;">Quality used cars from ${appData.trader.name}</p>
            </section>

            <section>
              <div style="margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center;">
                <span style="color: var(--text-muted);">${liveVehicles.length} vehicles available</span>
              </div>
              
              ${liveVehicles.length > 0 ? `
                <div class="vehicle-grid">
                  ${vehiclesHtml}
                </div>
              ` : `
                <div class="empty-state">
                  <div class="empty-state-icon">üöó</div>
                  <h3>No vehicles currently available</h3>
                  <p>Check back soon for new listings</p>
                </div>
              `}
            </section>
          </div>
        `;
      }

      renderVehicleCards(vehicles, isConsumerView = false) {
        if (vehicles.length === 0) {
          return '<div class="empty-state"><div class="empty-state-icon">üöó</div><p>No vehicles to display</p></div>';
        }

        return vehicles.map(vehicle => {
          const link3Info = this.getLink3Info(vehicle);
          
          return `
            <div class="vehicle-card" onclick="app.navigateTo('vehicle-detail', {vehicleId: '${vehicle.id}'})">
              ${vehicle.images && vehicle.images.primary ? `
                <img src="${vehicle.images.primary}" alt="${vehicle.make} ${vehicle.model}" class="vehicle-image">
              ` : `
                <div class="vehicle-image">üöó</div>
              `}
              
              <div class="vehicle-content">
                <div class="vehicle-header">
                  <div>
                    <div class="vehicle-title">${vehicle.make} ${vehicle.model}</div>
                    <div class="vehicle-year">${vehicle.year}</div>
                  </div>
                  <div class="vehicle-price">¬£${vehicle.price.toLocaleString()}</div>
                </div>

                <div class="vehicle-details">
                  <div class="vehicle-detail-item">‚öôÔ∏è ${vehicle.transmission}</div>
                  <div class="vehicle-detail-item">‚õΩ ${vehicle.fuelType}</div>
                  <div class="vehicle-detail-item">üöô ${vehicle.bodyType}</div>
                </div>

                <div class="vehicle-badges">
                  ${!isConsumerView ? `
                    <span class="badge ${vehicle.status === 'live' ? 'badge-success' : vehicle.status === 'sold' ? 'badge-secondary' : 'badge-warning'}">
                      ${vehicle.status}
                    </span>
                  ` : ''}
                  
                  ${link3Info.isLink3 ? `
                    <span class="${link3Info.stageBadgeClass}">
                      üîó ${link3Info.stageName}
                    </span>
                  ` : ''}

                  ${vehicle.offers.enabled && vehicle.offers.count > 0 ? `
                    <span class="badge badge-info">
                      üí∞ ${vehicle.offers.count} offer${vehicle.offers.count !== 1 ? 's' : ''}
                    </span>
                  ` : ''}
                </div>
              </div>
            </div>
          `;
        }).join('');
      }

      renderEmptyState(title, message) {
        return `
          <div class="container">
            <div class="empty-state">
              <div class="empty-state-icon">üì≠</div>
              <h3>${title}</h3>
              <p>${message}</p>
            </div>
          </div>
        `;
      }

      // Event Handlers
      attachLotHandlers() {
        document.querySelectorAll('.lot-card').forEach(card => {
          card.addEventListener('click', (e) => {
            const lotId = e.currentTarget.dataset.lotId;
            this.navigateTo('vehicles', { lotId });
          });
        });
      }

      attachVehicleHandlers() {
        // Handlers are inline in the HTML
      }

      attachDetailHandlers() {
        // Handlers are inline in the HTML
      }

      attachEditHandlers() {
        // Initialize with current selection
        const listingTypeInputs = document.querySelectorAll('input[name="listingType"]');
        listingTypeInputs.forEach(input => {
          if (input.checked) {
            this.toggleLink3Manual(input.value === 'link3-manual');
          }
        });
      }

      toggleLink3Manual(show) {
        const manualOptions = document.getElementById('link3-manual-options');
        if (manualOptions) {
          if (show) {
            manualOptions.classList.remove('hidden');
          } else {
            manualOptions.classList.add('hidden');
          }
        }
      }

      handleImageUpload(event) {
        const files = Array.from(event.target.files);
        this.uploadedImages = [];

        files.forEach(file => {
          const reader = new FileReader();
          reader.onload = (e) => {
            this.uploadedImages.push({
              name: file.name,
              dataUrl: e.target.result
            });
            this.renderImagePreviews();
          };
          reader.readAsDataURL(file);
        });
      }

      renderImagePreviews() {
        const container = document.getElementById('image-preview-container');
        if (!container || !this.uploadedImages) return;

        container.innerHTML = this.uploadedImages.map((img, index) => `
          <div class="image-preview">
            <img src="${img.dataUrl}" alt="${img.name}">
            <button type="button" class="image-preview-remove" onclick="app.removeImage(${index})">‚úï</button>
          </div>
        `).join('');
      }

      removeImage(index) {
        if (this.uploadedImages) {
          this.uploadedImages.splice(index, 1);
          this.renderImagePreviews();
        }
      }

      saveVehicle(event, vehicleId) {
        event.preventDefault();
        
        const form = event.target;
        const formData = new FormData(form);
        
        const vehicle = {
          lotId: formData.get('lotId'),
          make: formData.get('make'),
          model: formData.get('model'),
          year: parseInt(formData.get('year')),
          bodyType: formData.get('bodyType'),
          fuelType: formData.get('fuelType'),
          transmission: formData.get('transmission'),
          price: parseFloat(formData.get('price')),
          listingType: formData.get('listingType'),
          status: formData.get('status'),
          description: formData.get('description')
        };

        // Add Link3 specific fields
        if (vehicle.listingType === 'link3-auto' || vehicle.listingType === 'link3-manual') {
          vehicle.link3Stage = vehicle.listingType === 'link3-manual' ? formData.get('link3Stage') : 'top-buyers';
          vehicle.link3StartDate = new Date().toISOString();
        }

        // Add images if uploaded
        if (this.uploadedImages && this.uploadedImages.length > 0) {
          vehicle.images = {
            primary: this.uploadedImages[0].dataUrl,
            gallery: this.uploadedImages.map(img => img.dataUrl)
          };
        } else if (vehicleId) {
          // Keep existing images if updating and no new images
          const existing = appData.vehicles.find(v => v.id === vehicleId);
          if (existing && existing.images) {
            vehicle.images = existing.images;
          }
        }

        if (vehicleId) {
          // Update existing
          const index = appData.vehicles.findIndex(v => v.id === vehicleId);
          if (index !== -1) {
            appData.vehicles[index] = { 
              ...appData.vehicles[index], 
              ...vehicle
            };
            alert('Vehicle updated successfully');
            this.uploadedImages = null;
            this.navigateTo('vehicle-detail', { vehicleId });
          }
        } else {
          // Add new
          const newVehicle = {
            id: `veh-${Date.now()}`,
            ...vehicle,
            offers: { enabled: false, count: 0, highest: null }
          };
          
          appData.vehicles.push(newVehicle);
          alert('Vehicle added successfully');
          this.uploadedImages = null;
          this.navigateTo('vehicle-detail', { vehicleId: newVehicle.id });
        }
      }

      deleteVehicle(vehicleId) {
        if (confirm('Are you sure you want to delete this vehicle?')) {
          const index = appData.vehicles.findIndex(v => v.id === vehicleId);
          if (index !== -1) {
            appData.vehicles.splice(index, 1);
            alert('Vehicle deleted successfully');
            this.navigateTo('vehicles');
          }
        }
      }

      // Helper Methods
      getDashboardStats() {
        const vehicles = appData.vehicles;
        const lots = appData.lots;
        
        return {
          totalVehicles: vehicles.length,
          liveListings: vehicles.filter(v => v.status === 'live').length,
          draftListings: vehicles.filter(v => v.status === 'draft').length,
          soldListings: vehicles.filter(v => v.status === 'sold').length,
          activeLots: lots.filter(l => l.status === 'live').length
        };
      }

      getListingTypeCounts() {
        const vehicles = appData.vehicles;
        return {
          'trade-silent': vehicles.filter(v => v.listingType === 'trade-silent' && v.status === 'live').length,
          'public-silent': vehicles.filter(v => v.listingType === 'public-silent' && v.status === 'live').length,
          'open': vehicles.filter(v => v.listingType === 'open' && v.status === 'live').length,
          'fixed': vehicles.filter(v => v.listingType === 'fixed' && v.status === 'live').length
        };
      }

      getLink3Stats() {
        const vehicles = appData.vehicles;
        const link3Vehicles = vehicles.filter(v => 
          v.listingType === 'link3-auto' || v.listingType === 'link3-manual'
        );

        return {
          topBuyers: link3Vehicles.filter(v => v.link3Stage === 'top-buyers').length,
          baseBuyers: link3Vehicles.filter(v => v.link3Stage === 'base-buyers').length,
          publicClassified: link3Vehicles.filter(v => v.link3Stage === 'public-classified').length,
          totalActive: link3Vehicles.filter(v => v.status === 'live').length,
          sold: vehicles.filter(v => v.status === 'sold' && (v.listingType === 'link3-auto' || v.listingType === 'link3-manual')).length
        };
      }

      getLink3Info(vehicle) {
        if (!vehicle.listingType || (!vehicle.listingType.startsWith('link3'))) {
          return { isLink3: false };
        }

        const isAuto = vehicle.listingType === 'link3-auto';
        const stage = vehicle.link3Stage || 'draft';

        const stageInfo = {
          'draft': {
            name: 'Draft',
            duration: 0,
            next: 'Top Tier Buyers',
            badgeClass: 'badge badge-secondary'
          },
          'top-buyers': {
            name: 'Stage 1: Top Buyers',
            duration: 3,
            next: 'Stage 2: Base Buyers',
            badgeClass: 'badge badge-success'
          },
          'base-buyers': {
            name: 'Stage 2: Base Buyers',
            duration: 3,
            next: 'Stage 3: Public Classified',
            badgeClass: 'badge badge-warning'
          },
          'public-classified': {
            name: 'Stage 3: Public',
            duration: 28,
            next: null,
            badgeClass: 'badge badge-info'
          }
        };

        const info = stageInfo[stage] || stageInfo['draft'];
        const daysRemaining = this.getDaysRemaining(vehicle.link3StartDate, info.duration);

        return {
          isLink3: true,
          isAuto,
          stageName: info.name,
          stageBadgeClass: info.badgeClass,
          daysRemaining,
          nextStage: info.next
        };
      }

      getDaysRemaining(startDate, duration) {
        if (!startDate || duration === 0) return '-';
        
        const start = new Date(startDate);
        const now = new Date();
        const daysPassed = Math.floor((now - start) / (1000 * 60 * 60 * 24));
        const remaining = duration - daysPassed;
        
        return Math.max(0, remaining);
      }

      getListingTypeLabel(type) {
        const labels = {
          'link3-auto': 'üîó Link3 Auto',
          'link3-manual': 'üîó Link3 Manual',
          'trade-silent': 'üîá Trade Silent',
          'public-silent': 'ü§´ Public Silent',
          'open': 'üì£ Open Offers',
          'fixed': 'üí∑ Fixed Price'
        };
        return labels[type] || type;
      }
    }

    // Initialize app
    const app = new CarLinxApp();
  </script>
</body>
</html>